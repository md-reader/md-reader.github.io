import{f as B,a9 as M,aa as Y,ab as N,ac as H,r as v,ad as K,g as j,j as Q,c as T,o as b,a as c,D as X,b as t,ae as Z,a3 as a,af as ee,w as l,d as p,t as I,ag as U,ah as ae,ai as se,aj as te,ak as D,_ as oe}from"./DIqI4X7b.js";import{o as ie,s as R,_ as le,a as ne,b as re}from"./HDGkpKbD.js";const de={class:"full-page-card w-[450px] !px-8","data-aos":"fade-in-up"},me={class:"py-2 mb-[20px] flex justify-center"},ue={key:0},ce={class:"text-center !mt-[12px]"},fe={key:1},pe={class:"text-center !mt-[12px]"},ge={class:"!mt-[8px] text-right"},w=60,_e=B({__name:"login",setup(O){const{onLogin:S,fetchUserInfo:k}=M(),P=Y(),h=N(),C=H(),f=v(),o=v(!1),d=v(!0),V=v(!1),y=v(!1);let x;const g=v(w),r=K({email:void 0,password:void 0}),$=ie({email:R({required_error:"Email is required"}).email("Invalid email"),password:R({required_error:"Password is required"}).min(6,"Password must be at least 6 characters").max(64,"Password must be less than 64 characters")});j(()=>{E()});function A(i){let e=i.data;if(e){const n={email:e.email,password:U(e.password)};o.value=!0,te(n).then(async s=>{var m;if((s==null?void 0:s.status)==="success"){await S(),(m=f.value)==null||m.clear();const _=h.query.redirect;D(P(_||"/")),h.query.from==="extension"&&(window.opener.postMessage({...s.data,accessToken:localStorage.getItem("accessToken"),refreshToken:localStorage.getItem("refreshToken")},"*"),window.close())}else throw new Error(s.message||"Failed to login")}).catch(s=>{var m;console.error(s),(m=f.value)==null||m.setErrors([{message:s.message,path:"email"},{message:s.message,path:"password"}])}).finally(()=>{o.value=!1,k().catch(s=>{console.error(s)})})}}async function G(){f.value.validate().then(i=>{i&&q({email:i.email,password:U(i.password)})})}function J(i){let e=i.data;e&&z({email:e.email})}async function W(){y.value?z({email:r.email}):q({email:r.email,password:U(r.password)})}async function q(i){return o.value=!0,ae(i).then(e=>{var n;if((e==null?void 0:e.status)==="success"&&((n=e==null?void 0:e.data)==null?void 0:n.code)===201)F();else throw new Error(e.message||"Failed to sign up")}).catch(e=>{var n;console.error(e),d.value=!1,C.add({icon:"i-ri-error-warning-fill",title:"Failed to sign up",description:e.message,color:"red"}),(n=f.value)==null||n.setErrors([{message:e.message,path:"email"},{message:e.message,path:"password"}])}).finally(()=>{o.value=!1})}async function z(i){return o.value=!0,se(i).then(e=>{if((e==null?void 0:e.status)==="success")F();else throw new Error(e.message||"Failed to reset password")}).catch(e=>{var n;console.error(e),d.value=!1,C.add({icon:"i-ri-error-warning-fill",title:"Failed to reset password",description:e.message,color:"red"}),(n=f.value)==null||n.setErrors([{message:e.message,path:"email"}])}).finally(()=>{o.value=!1})}function F(){V.value=!0,g.value=w,clearTimeout(x),localStorage.setItem("verifyLoadingStartTime",JSON.stringify(Date.now())),E()}function E(){const i=localStorage.getItem("verifyLoadingStartTime");if(i&&(g.value=Date.now()-Number.parseInt(i),g.value<1e3*w)){d.value=!0,x=setTimeout(E,500);return}clearTimeout(x),d.value=!1}return Q(()=>{clearTimeout(x)}),(i,e)=>{const n=Z,s=ee,m=re,_=ne,L=le;return b(),T("div",de,[c("div",me,[t(n,{disabled:""})]),a(V)?(b(),T("div",ue,[e[7]||(e[7]=c("h3",{class:"form-title"},"Email Verification",-1)),e[8]||(e[8]=c("p",{class:"form-desc"},"Verification email sent. Please check your inbox and click the link within 10 minutes to complete verification.",-1)),t(s,{size:"md",disabled:a(d)||a(o),block:"",variant:"outline",onClick:W},{default:l(()=>[p(" Resend verification email "+I(a(d)?`(${w-Math.floor(a(g)/1e3)}s)`:""),1)]),_:1},8,["disabled"]),c("div",ce,[t(s,{class:"p-0",size:"md",disabled:a(o),color:"primary",variant:"link",onClick:e[0]||(e[0]=u=>{V.value=!1,y.value=!1})},{default:l(()=>e[6]||(e[6]=[p(" Back to Sign in ")])),_:1},8,["disabled"])])])):a(y)?(b(),T("div",fe,[e[10]||(e[10]=c("h3",{class:"form-title"},"Reset Password",-1)),e[11]||(e[11]=c("p",{class:"form-desc"},"Please enter your account email. We'll send you a verification code to help reset your password.",-1)),t(L,{ref_key:"formRef",ref:f,state:a(r),schema:a($),class:"space-y-4",onSubmit:J},{default:l(()=>[t(_,{required:"",name:"email"},{default:l(()=>[t(m,{modelValue:a(r).email,"onUpdate:modelValue":e[1]||(e[1]=u=>a(r).email=u),disabled:a(o),placeholder:"Email",size:"md",autofocus:""},null,8,["modelValue","disabled"])]),_:1}),t(s,{size:"md",disabled:a(d)||a(o),block:"",type:"submit"},{default:l(()=>[p(" Continue "+I(a(d)?`(${w-Math.floor(a(g)/1e3)}s)`:""),1)]),_:1},8,["disabled"]),c("div",pe,[t(s,{class:"p-0",size:"md",disabled:a(o),color:"primary",variant:"link",onClick:e[2]||(e[2]=u=>y.value=!1)},{default:l(()=>e[9]||(e[9]=[p(" Back to Sign in ")])),_:1},8,["disabled"])])]),_:1},8,["state","schema"])])):(b(),X(L,{key:2,ref_key:"formRef",ref:f,state:a(r),schema:a($),class:"space-y-4",onSubmit:A},{default:l(()=>[t(_,{required:"",name:"email"},{default:l(()=>[t(m,{modelValue:a(r).email,"onUpdate:modelValue":e[3]||(e[3]=u=>a(r).email=u),disabled:a(o),placeholder:"Email",size:"md",autofocus:""},null,8,["modelValue","disabled"])]),_:1}),t(_,{required:"",name:"password"},{default:l(()=>[t(m,{modelValue:a(r).password,"onUpdate:modelValue":e[4]||(e[4]=u=>a(r).password=u),type:"password",disabled:a(o),placeholder:"Password",size:"md"},null,8,["modelValue","disabled"])]),_:1}),c("div",ge,[t(s,{class:"p-0",size:"md",disabled:a(o),color:"primary",variant:"link",onClick:e[5]||(e[5]=u=>y.value=!0)},{default:l(()=>e[12]||(e[12]=[p(" Forgot password? ")])),_:1},8,["disabled"])]),t(_,{class:"!mt-[6px]"},{default:l(()=>[t(s,{size:"md",disabled:a(o),block:"",type:"submit"},{default:l(()=>e[13]||(e[13]=[p(" Sign In ")])),_:1},8,["disabled"]),t(s,{size:"md",class:"mt-[10px]",disabled:a(d)||a(o),block:"",variant:"soft",onClick:G},{default:l(()=>[p(" Sign Up "+I(a(d)?`(${w-Math.floor(a(g)/1e3)}s)`:""),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["state","schema"]))])}}}),ve=oe(_e,[["__scopeId","data-v-11b5566e"]]),we={class:"full-page-container"},ke=B({__name:"login",setup(O){const S=N();return j(()=>{const{isLoggedIn:k}=M();k.value&&S.query.from!=="extension"&&D("/")}),(k,P)=>{const h=ve;return b(),T("div",we,[t(h)])}}});export{ke as default};
